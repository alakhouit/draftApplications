<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">

<f:view contentType="text/html">
	
	<h:form id="studentForm">
	
		<p:dataTable var="student" value="#{studentBean.students}"
			emptyMessage="Sistemde hiç bir öğrenci bulunmuyor" id="studentDT" widgetVar="studentDT" style="width: 680px;" rowKey="#{student.no}"
			paginator="true" rows="10" rowsPerPageTemplate="10,20,30,40,50" sortMode="multiple"
			paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
			<p:column headerText="No" style="width: 7%;">
				<h:outputText value="#{student.no}" />
			</p:column>
			<p:column headerText="İsim" style="width: 32%;" sortBy="#{student.name}">
				<h:outputText value="#{student.name}" />
			</p:column>
			<p:column headerText="Cinsiyet" style="width: 14%;">
				<h:outputText value="#{student.gender}">
					<f:converter converterId="genderConverter"/>
				</h:outputText>
			</p:column>
			<p:column headerText="Okul Numarası" style="width: 18%;" sortBy="#{student.schoolNumber}">
				<h:outputText value="#{student.schoolNumber}" />
			</p:column>
			<p:column headerText="Sınıfı" style="width: 9%;">
				<h:outputText value="#{student.schoolClass.name}" />
			</p:column>
			<p:column headerText="Sil" style="width: 8%;text-align:center;">
				<p:commandButton process="@this" icon="ui-icon-close" title="Sil" oncomplete="PF('deleteConfirmationDialog').show();" update=":deleteConfirmationDialog">
					<f:setPropertyActionListener value="#{student}" target="#{studentBean.paramStudent}"/>		
				</p:commandButton>		
			</p:column>
			<p:column headerText="Güncelle" style="width: 12%;text-align:center;">
				<p:commandButton process="@this" icon="ui-icon-edit" title="Güncelle" oncomplete="PF('updateDialog').show();" update=":updateDialog">
					<f:setPropertyActionListener value="#{student}" target="#{studentBean.paramStudent}"/>
					<f:setPropertyActionListener value="#{student.schoolClass.no}" target="#{studentBean.paramClassNo}"/>
				</p:commandButton>			
			</p:column>

			<f:facet name="footer">
				<p:commandButton value="Yeni Öğrenci Ekle" icon="ui-icon-add" oncomplete="PF('addDialog').show();" />
			</f:facet>
		</p:dataTable>
				
	</h:form>
	
		
	<p:dialog id="addDialog" style="text-align:center" widgetVar="addDialog" header="Öğrenci Ekleme" width="370" resizable="false" height="190">
	
		<h:form id="addForm">  
			<p:outputPanel id="addPanel" styleClass="ui-panel-titlebar ui-widget-header ui-helper-clearfix ui-corner-all">
				<h:panelGrid columns="2" border="0" cellpadding="4" style="margin:0 auto;" columnClasses="rightAlignClass,leftAlignClass">
					<p:outputLabel value="İsim:" />
					<h:inputText id="studentName" style="width:200px;" required="true" requiredMessage="İsim alanı boş bırakılamaz" value="#{studentBean.newStudent.name}" />
					<p:outputLabel value="Cinsiyet:" />
					<p:selectOneMenu id="genderInput" value="#{studentBean.newStudent.gender}">
		            	<f:selectItem itemLabel="Kız" itemValue="female" />
		            	<f:selectItem itemLabel="Erkek" itemValue="male" />
		        	</p:selectOneMenu>    		
		        	<p:outputLabel value="Okul Numarası:" />
		        	<h:inputText id="schoolNumber" style="width:50px;" required="true" requiredMessage="Okul numarası alanı boş bırakılamaz" value="#{studentBean.newStudent.schoolNumber}" />
		        	<p:outputLabel value="Sınıf:" />
					<p:selectOneMenu id="classMenu" value="#{studentBean.paramClassNo}">
						<f:selectItems value="#{studentBean.classes}" var="classItem" itemLabel="#{classItem.name}" itemValue="#{classItem.no}"/>						
					</p:selectOneMenu>
					<f:facet name="footer">
						<p:commandButton id="addButtonCmd" value="Yeni Öğrenci Ekle" oncomplete="handleSubmitRequest( xhr, status, args, 'addDialog', 'addForm' );" actionListener="#{studentBean.addNewStudent}" update=":studentForm, :growl" />
						<p:spacer width="15"/>
						<p:commandButton value="İptal" onclick="PF('addDialog').hide();"/>
					</f:facet>	  					
				</h:panelGrid>
			</p:outputPanel>
		</h:form>
		
	</p:dialog>
					
		
	<p:dialog id="updateDialog" style="text-align:center" widgetVar="updateDialog" header="Öğrenci Güncelleme" width="370" resizable="false" height="190">
			
		<h:form id="updateForm">  
			<p:outputPanel id="updatePanel" styleClass="ui-panel-titlebar ui-widget-header ui-helper-clearfix ui-corner-all">
				<h:panelGrid columns="2" border="0" cellpadding="4" style="margin:0 auto;" columnClasses="rightAlignClass,leftAlignClass">
					<p:outputLabel value="İsim:" />
					<h:inputText id="studentNameUpdate" style="width:200px;" required="true" requiredMessage="İsim alanı boş bırakılamaz" value="#{studentBean.paramStudent.name}" />
					<p:outputLabel value="Cinsiyet:" />
					<p:selectOneMenu id="genderInputUpdate" value="#{studentBean.paramStudent.gender}">
		            	<f:selectItem itemLabel="Kız" itemValue="female" />
		            	<f:selectItem itemLabel="Erkek" itemValue="male" />
		        	</p:selectOneMenu>    		
		        	<p:outputLabel value="Okul Numarası:" />
		        	<h:inputText id="schoolNumberUpdate" style="width:50px;" required="true" requiredMessage="Okul numarası alanı boş bırakılamaz" value="#{studentBean.paramStudent.schoolNumber}" />
		        	<p:outputLabel value="Sınıf:" />
					<p:selectOneMenu id="classMenuUpdate" value="#{studentBean.paramClassNo}">
						<f:selectItems value="#{studentBean.classes}" var="classItem" itemLabel="#{classItem.name}" itemValue="#{classItem.no}"/>						
					</p:selectOneMenu>
					<f:facet name="footer">
						<p:commandButton id="updateButtonCmd" value="Öğrenci Güncelle" oncomplete="handleSubmitRequest( xhr, status, args, 'updateDialog', 'updateForm' );" actionListener="#{studentBean.updateStudent}" update=":studentForm, :growl" />
						<p:spacer width="15"/>
						<p:commandButton value="İptal" oncomplete="PF('updateDialog').hide();"/>
					</f:facet>	  					
				</h:panelGrid>
			</p:outputPanel>
		</h:form>
		
	</p:dialog>
	
						
	<p:dialog id="deleteConfirmationDialog" style="text-align:center" widgetVar="deleteConfirmationDialog" header="Onaylama" width="350" resizable="false" height="120">
		
		<h:form id="deleteForm">
			<p:outputPanel id="deletePanel" styleClass="ui-panel-titlebar ui-widget-header ui-helper-clearfix ui-corner-all">
				<h:panelGrid columns="1" border="0" cellpadding="4" style="margin:0 auto;" columnClasses="leftAlignClass">
					<h:outputText value="'#{studentBean.paramStudent.name}' isimli öğrenciyi" />
					<h:outputText value="silmek istediğinizden emin misiniz?" />
					<f:facet name="footer">
        				<p:commandButton id="deleteButtonCmd" process="@this" value="Evet" icon="ui-icon-check" oncomplete="handleSubmitRequest( xhr, status, args, 'deleteConfirmationDialog', 'deleteForm' );" action="#{studentBean.removeStudent}" update=":studentForm, :growl" />
        				<p:spacer width="40"/>
        				<p:commandButton value="Hayır" icon="ui-icon-close" onclick="PF('deleteConfirmationDialog').hide();" />
        			</f:facet>
        		</h:panelGrid>
			</p:outputPanel>										
		</h:form>
		
	</p:dialog>
	
	<pe:keyFilter for=":addForm:schoolNumber" mask="num"/>
	<pe:keyFilter for=":updateForm:schoolNumberUpdate" mask="num"/>
	
</f:view>

<p:growl id="growl" showDetail="true" life="4000" />
	
<script type="text/javascript">  
    
    function handleSubmitRequest(xhr, status, args, dialogName, formName ) {  
        dialog = jQuery('#' + dialogName );
        
        if ( args.validationFailed ) {  
            dialog.effect("shake", { times:3 }, 100);  
        } else {
            clearForm( formName );
            dialog.hide();  
        }  
    }
    
    function clearForm( formName ) {
        jQuery('#' + formName ).each(function(){ this.reset(); });
    }
</script> 

</html>
