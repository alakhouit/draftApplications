<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">

<f:view contentType="text/html">
	<h:form id="studentForm">
	
		<p:dataTable var="student" value="#{studentBean.students}"
			emptyMessage="Sistemde hiç bir öğrenci bulunmuyor" id="studentDT" widgetVar="studentDT" style="width: 650px;">
			<p:column headerText="No" style="width: 9%;">
				<h:outputText value="#{student.no}" />
			</p:column>
			<p:column headerText="İsim" style="width: 35%;">
				<h:outputText value="#{student.name}" />
			</p:column>
			<p:column headerText="Cinsiyet" style="width: 18%;">
				<h:outputText value="#{student.gender}">
					<f:converter converterId="genderConverter"/>
				</h:outputText>
			</p:column>
			<p:column headerText="Okul Numarası" style="width: 19%;">
				<h:outputText value="#{student.schoolNumber}" />
			</p:column>
			<p:column headerText="Sınıfı" style="width: 12%;">
				<h:outputText value="#{student.schoolClass.name}" />
			</p:column>
			<p:column headerText="Sil" style="width: 7%;">
				<p:commandButton process="@this" icon="ui-icon-close" title="Sil">
				</p:commandButton>				
			</p:column>

			<f:facet name="footer">
				<p:commandButton value="Yeni Öğrenci Ekle" icon="ui-icon-add" oncomplete="PF('addDialog').show();" />
			</f:facet>
		</p:dataTable>		
		
		<p:dialog id="addDialog" style="text-align:center" widgetVar="addDialog" header="Öğrenci Ekleme" width="350" resizable="false" height="180">  
			<p:outputPanel id="addPanel" styleClass="ui-panel-titlebar ui-widget-header ui-helper-clearfix ui-corner-all">
				<h:panelGrid columns="2" border="0" cellpadding="4" style="margin:0 auto;" columnClasses="rightAlignClass,leftAlignClass">
					<p:outputLabel value="İsim:" />
					<p:inputText id="studentName" style="width:200px;" required="true" requiredMessage="İsim alanı boş bırakılamaz" value="#{studentBean.paramStudent.name}" />
					<p:outputLabel value="Cinsiyet:" />
					<p:selectOneMenu id="genderInput" value="#{studentBean.paramStudent.gender}">
		            	<f:selectItem itemLabel="Kız" itemValue="female" />
		            	<f:selectItem itemLabel="Erkek" itemValue="male" />
		        	</p:selectOneMenu>    		
		        	<p:outputLabel value="Okul Numarası:" />
		        	<p:inputText id="schoolNumber" style="width:50px;" required="true" requiredMessage="Okul numarası alanı boş bırakılamaz" value="#{studentBean.paramStudent.schoolNumber}" />
		        	<p:outputLabel value="Sınıf:" />
					<p:selectOneMenu id="classMenu" value="#{studentBean.paramClassNo}">
						<f:selectItems value="#{studentBean.classes}" var="classItem" itemLabel="#{classItem.name}" itemValue="#{classItem.no}"/>						
					</p:selectOneMenu>
					<f:facet name="footer">
						<p:commandButton value="Yeni Öğrenci Ekle" oncomplete="handleSubmitRequest( xhr, status, args, 'addDialog' );" actionListener="#{studentBean.addNewStudent}" update=":studentForm, :growl" />
						<p:spacer width="15"/>
						<p:commandButton value="İptal" onclick="PF('addDialog').hide();"/>
					</f:facet>	  					
				</h:panelGrid>
			</p:outputPanel>
		</p:dialog>
				
		<pe:keyFilter for="schoolNumber" mask="num"/>
	</h:form>
</f:view>

<p:growl id="growl" showDetail="true" life="3000" />
	
<script type="text/javascript">  
    
    function handleSubmitRequest(xhr, status, args, dialogName ) {  
        dialog = jQuery('#'+dialogName);
        
        if ( args.validationFailed ) {  
            dialog.effect("shake", { times:3 }, 100);  
        } else {
            clearForm();
            dialog.hide();  
        }  
    }
    
    function clearForm(formName){
        jQuery('#studentForm').each(function(){ this.reset(); });
    }
</script> 

</html>
